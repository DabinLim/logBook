<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hanghae99</title>
    <!-- css -->
    <link rel="stylesheet" href="/static/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <link rel="stylesheet" href="/static/join.css">
    <link rel="stylesheet" href="/static/login.css">

    <!-- script -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/static/join.js" defer ></script>
    <script>
      function signup() {
        let name = $('#name').val()
        let email = $('#email').val()
        let birth = $('#dateOfbirth').val()
        let password = $('#joinPassword').val()
        $.ajax({
          type: "POST",
          url: "/api/signup",
          data: {
            name: name,
            email: email,
            birth: birth,
            password: password
          },
          success: function (response) {
            if (response['result'] == 'success') {

              alert('가입이 완료되었습니다.');
              modal_close();
            } else {
              alert(response['msg']);
            }
          }
        })
      }

      function login() {
        let username = $("#username").val()
        let password = $("#password").val()

        if (username == null) {
          $("#help_id").text("아이디를 입력해주세요.")
          $("#username").focus()
          return;
        } else {
          $("#help_id").text("")
        }

        if (password == null) {
          $("#help_pw").text("비밀번호를 입력해주세요.")
          $("#password").focus()
          return;
        } else {
          $("#help_pw").text("")
        }
        $.ajax({
          type: "POST",
          url: "/api/login",
          data: { username_give: username, password_give: password },
          success: function (response) {
            if (response['result'] == 'success') {
              document.cookie = `token=${response['token']}`
              alert('로그인이 완료되었습니다.')
              window.location.href = '/main'
            } else {
              alert(response['msg'])
              window.location.reload();
            }
          }
        })
      }
      
      function modal_active() {
        const signup = document.querySelector('.modal');
        signup.classList.add('is-active');
      }
      function modal_close() {
        const modalClose = document.querySelector('.modal');
        modalClose.classList.remove('is-active');
      }
    </script>

  </head>

  <body>
    <div class="container">
      <div class="icon-box">
        <img src="static/hanghae.png" alt="항해">
      </div>
      <div class="box">
        <div class="field">
          <label class="label">ID</label>
          <div class="control">
            <input id="username" class="input" type="text">
            <p class="help_id"></p>
          </div>
        </div>
        <div class="field">
          <label class="label">Password</label>
          <div class="control">
            <input id="password" class="input" type="text">
            <p class="help_pw"></p>
          </div>
        </div>
        <div class="sign">
          <button class="button is-primary" onclick="login()">Sign in</button>
          <button class="button is-primary" onclick="modal_active()">Sign Up</button>
        </div>
      </div>
      <div class="modal">
        <div class="modal-background"></div>
        <div class="modal-content">
            <main class="join__box">
              <img class="join__img" src="../static/항해99.png"></img>
              <div class="join__container">
                <label class="join__name join__row">
                  <div>이름</div>
                  <input type="text" name="name" form="join-form" placeholder="이름을 작성해 주세요">
                </label>
                <label class="join__birth join__row">
                  <span>생년월일</span>
                  <span>ex)950331</span>
                  <input type="datetime" name="birth" form="join-form" placeholder="생년월일을 작성해 주세요">
                </label>
                <label class="join__email join__row">
                  <div>이메일</div>
                  <input type="email" name="email" form="join-form" placeholder="이메일을 작성해 주세요">
                </label>
                <button class="checkOverlapBtn">중복 검사</button>
                <label class="join__password join__row">
                  <span>비밀번호</span>
                  <span>ex) 영문, 숫자는 1개 씩 무조건 포함,8-20자 길이</span>
                  <input type="password" name="password" form="join-form" placeholder="비밀번호를 작성해주세요 ">
                </label>
              </div>
              <button class="join__btn">join</button>
            </main>
        </div>
        <button class="modal-close is-large button" aria-label="close" onclick="modal_close()"></button>
      </div>
    </div>
  </body>
</html>